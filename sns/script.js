const firebaseConfig={apiKey:"AIzaSyCCw9vbQuF9CJzyvhfy__UDIGq9SQO0KA8",authDomain:"thinking-sns.firebaseapp.com",projectId:"thinking-sns",storageBucket:"thinking-sns.firebasestorage.app",messagingSenderId:"133464509665",appId:"1:133464509665:web:c0b8769832c1d56ef9bba0",measurementId:"G-WZCMJ4R2TF"};import{initializeApp}from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";import{getFirestore,collection,doc,setDoc,getDoc,getDocs,query,orderBy,limit,serverTimestamp,startAfter,updateDoc}from "https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js";const app=initializeApp(firebaseConfig);const db=getFirestore(app);let lastVisible=null;let isLoading=!1;const REACTIONS=['â¤ï¸','ğŸ‘','ğŸ¤”','ğŸ¤','âœ…'];const dialog2=document.getElementById('dialog2');const dialog2Headline=dialog2.querySelector('div[slot="headline"]');const dialog2Content=dialog2.querySelector('form[slot="content"]');function updatePlaceholder(){const textInput=document.getElementById("text");const isMini=document.getElementById("mini").checked;textInput.placeholder=isMini?"3æ–‡å­—ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›":"ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›"} async function handleReaction(docId,reaction){try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const docRef=doc(collection(parentDocRef,'maintext'),docId);const docSnap=await getDoc(docRef);if(docSnap.exists()){const data=docSnap.data();let reactions=data.reactions||{};reactions[reaction]=(reactions[reaction]||0)+1;await updateDoc(docRef,{reactions});const reactionButton=document.querySelector(`#reaction-button-${docId}-${reaction}`);if(reactionButton){updateReactionButton(reactionButton,reactions[reaction],reaction,data.bg,data.color)}}}catch(error){console.error("ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ›´æ–°ã‚¨ãƒ©ãƒ¼:",error)}} function updateReactionButton(button,count,emoji,postBg,postColor){button.innerHTML=`${emoji}${count} <md-ripple></md-ripple>`;button.style.backgroundColor=postColor||"#ffffff";button.style.color=postBg||"#000000"} function createReactionButtons(docId,reactions={},postBg,postColor){const container=document.createElement('div');container.className='reaction-buttons';container.style.marginTop='8px';REACTIONS.forEach(reaction=>{const button=document.createElement('button');button.id=`reaction-button-${docId}-${reaction}`;button.className='reactionbtn';button.style.cursor='pointer';button.innerHTML=`${reaction}${reactions[reaction] || 0} <md-ripple></md-ripple>`;button.style.backgroundColor=postColor+"dd"||"#ffffff";button.style.color=postBg||"#000000";button.addEventListener('click',()=>handleReaction(docId,reaction));container.appendChild(button)});return container} function displayDelayedText(element,text,startTime){const currentTime=new Date().getTime();const elapsedTime=(currentTime-startTime)/1000;const charactersToShow=Math.floor(elapsedTime/20);if(charactersToShow>=text.length){element.textContent=text}else{element.textContent=text.substring(0,charactersToShow)+'â–®';requestAnimationFrame(()=>displayDelayedText(element,text,startTime))}} async function submitPost(){const text=document.getElementById("text").value;const bg=document.getElementById("bg").value;const color=document.getElementById("color").value;const isDelay=document.getElementById("delay").checked;const isMini=document.getElementById("mini").checked;if(!text){dialog2Headline.textContent='ã™ã£ã‹ã‚‰ã‹ã‚“!';dialog2Content.textContent='ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';await dialog2.show();return} if(isMini&&text.length!==3){dialog2Headline.textContent='3æ–‡å­—ã§!';dialog2Content.textContent='ãƒŸãƒ‹æŠ•ç¨¿ã§ã¯3æ–‡å­—ã—ã‹æŠ•ç¨¿ã§ãã¾ã›ã‚“ã€‚';await dialog2.show();return} try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const collectionName=isMini?'minitext':'maintext';const subColRef=collection(parentDocRef,collectionName);const subDocRef=doc(subColRef);await setDoc(subDocRef,{text,bg,color,createdAt:serverTimestamp(),reactions:{},replies:{},delay:isDelay});document.getElementById("text").value="";document.getElementById("bg").value="#ffffff";document.getElementById("color").value="#000000";dialog2Headline.textContent='å®Œäº†!';dialog2Content.textContent='æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸ!';await dialog2.show();lastVisible=null;if(isMini){await displayMiniPosts()}else{await displayPosts()}}catch(error){console.error("æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:",error);dialog2Headline.textContent='æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼';dialog2Content.textContent='æŠ•ç¨¿ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚è©³ã—ãã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';await dialog2.show()}} async function displayMiniPosts(){try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const subColRef=collection(parentDocRef,'minitext');const q=query(subColRef,orderBy("createdAt","desc"),limit(13));const querySnapshot=await getDocs(q);const miniContainer=document.getElementById("miniPost");if(!miniContainer){console.error("miniPostè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");return} miniContainer.innerHTML="";querySnapshot.forEach((doc)=>{const data=doc.data();const miniBox=document.createElement("div");miniBox.className="mini-post-box";miniBox.style.backgroundColor=data.bg||"#ffffff";miniBox.style.color=data.color||"#000000";miniBox.style.display="inline-block";miniBox.textContent=data.text;miniContainer.appendChild(miniBox)})}catch(error){console.error("ãƒŸãƒ‹æŠ•ç¨¿å–å¾—ã‚¨ãƒ©ãƒ¼:",error)}} async function handleReply(postId,replyText){if(!replyText){dialog2Headline.textContent='ä½•ã‚‚ãªã„!';dialog2Content.textContent='è¿”ä¿¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';await dialog2.show();return} try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const postDocRef=doc(collection(parentDocRef,'maintext'),postId);const postSnap=await getDoc(postDocRef);if(postSnap.exists()){const data=postSnap.data();const replies=data.replies||{};const replyId=Math.random().toString(36).substring(2,15);replies[replyId]={text:replyText,createdAt:new Date().toISOString(),};await updateDoc(postDocRef,{replies});dialog2Headline.textContent='å®Œäº†!';dialog2Content.textContent='è¿”ä¿¡ã•ã‚Œã¾ã—ãŸ!';await dialog2.show();displayReplies(postId)}}catch(error){console.error("è¿”ä¿¡ä¿å­˜ã‚¨ãƒ©ãƒ¼:",error);dialog2Headline.textContent='è¿”ä¿¡ä¿å­˜ã‚¨ãƒ©ãƒ¼';dialog2Content.textContent='è¿”ä¿¡ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚è©³ã—ãã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';await dialog2.show()}} async function displayReplies(postId){try{const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const postDocRef=doc(collection(parentDocRef,'maintext'),postId);const postSnap=await getDoc(postDocRef);if(postSnap.exists()){const data=postSnap.data();const replies=data.replies||{};const replyList=document.querySelector(`.reply-list[data-doc-id="${postId}"]`);replyList.innerHTML="";Object.entries(replies).forEach(([id,reply])=>{const replyBox=document.createElement("div");replyBox.className='reply-box';const replyText=document.createElement("div");replyText.className='reply-text';replyText.textContent=reply.text;replyBox.appendChild(replyText);const replyTime=document.createElement("div");replyTime.className='reply-time';replyTime.textContent=new Date(reply.createdAt).toLocaleString();replyBox.appendChild(replyTime);replyList.appendChild(replyBox)})}}catch(error){console.error("è¿”ä¿¡è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:",error);dialog2Headline.textContent='è¿”ä¿¡å–å¾—ã‚¨ãƒ©ãƒ¼';dialog2Content.textContent='è¿”ä¿¡ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚è©³ã—ãã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';await dialog2.show()}} async function displayPosts(loadMore=!1){if(isLoading)return;isLoading=!0;try{const loadMoreButton=document.getElementById("loadMoreButton");if(loadMoreButton){loadMoreButton.textContent="èª­ã¿è¾¼ã¿ä¸­...";loadMoreButton.disabled=!0} const parentDocRef=doc(db,'post-1/wsbxPa2kQDaexLV9hiVC');const subColRef=collection(parentDocRef,'maintext');let q;if(loadMore&&lastVisible){q=query(subColRef,orderBy("createdAt","desc"),startAfter(lastVisible),limit(7))}else{q=query(subColRef,orderBy("createdAt","desc"),limit(7))} const querySnapshot=await getDocs(q);const postContainer=document.getElementById("postList");if(!loadMore){postContainer.innerHTML=""} querySnapshot.forEach((doc)=>{const data=doc.data();const postId=doc.id;const postBox=document.createElement("div");postBox.className="post-box";postBox.style.backgroundColor=data.bg||"#ffffff";postBox.style.color=data.color||"#000000";const postText=document.createElement("div");postText.className="post-text";if(data.delay){postText.textContent="â–®";const createdAtTime=data.createdAt?.toDate().getTime()||new Date().getTime();displayDelayedText(postText,data.text||"ãƒ†ã‚­ã‚¹ãƒˆãªã—",createdAtTime)}else{postText.textContent=data.text||"ãƒ†ã‚­ã‚¹ãƒˆãªã—"} postBox.appendChild(postText);const reactionContainer=createReactionButtons(postId,data.reactions,data.bg,data.color);postBox.appendChild(reactionContainer);const repliesContainer=document.createElement("div");repliesContainer.className="replies-container";repliesContainer.style.marginTop="10px";const showRepliesButton=document.createElement("button");showRepliesButton.textContent="è¿”ä¿¡ã‚’è¡¨ç¤º";showRepliesButton.className="nobg";showRepliesButton.dataset.docId=postId;showRepliesButton.innerHTML="è¿”ä¿¡ã‚’è¡¨ç¤º <md-ripple></md-ripple>";showRepliesButton.style.color=data.color||"#000000";const replyInput=document.createElement("div");replyInput.style.display="none";replyInput.className="reply-input-container";const replyText=document.createElement("input");replyText.type="text";replyText.className="replyinput";replyText.placeholder="è¿”ä¿¡ã‚’å…¥åŠ›";const submitReplyButton=document.createElement("button");submitReplyButton.className="replybtn";submitReplyButton.dataset.docId=postId;submitReplyButton.innerHTML="è¿”ä¿¡ <md-ripple></md-ripple>";submitReplyButton.style.color=data.bg||"#fff";submitReplyButton.style.backgroundColor=data.color||"#000";submitReplyButton.addEventListener("click",()=>handleReply(postId,replyText.value));replyInput.appendChild(replyText);replyInput.appendChild(submitReplyButton);postBox.appendChild(replyInput);const replyList=document.createElement("div");replyList.className="reply-list";replyList.dataset.docId=postId;postBox.appendChild(replyList);postBox.appendChild(showRepliesButton);postContainer.appendChild(postBox);showRepliesButton.addEventListener("click",async()=>{replyInput.style.display=replyInput.style.display==="none"?"block":"none";await displayReplies(postId)})});const documents=querySnapshot.docs;
lastVisible=documents[documents.length-1]||null;if(loadMoreButton){if(documents.length<7){loadMoreButton.style.display="none"}else{loadMoreButton.style.display="block";loadMoreButton.disabled=!1;loadMoreButton.innerHTML="ã‚‚ã£ã¨èª­ã¿è¾¼ã‚€ <md-ripple></md-ripple>"}}}catch(error){console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",error);dialog2Headline.textContent='ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼';dialog2Content.textContent='æŠ•ç¨¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚è©³ã—ãã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';await dialog2.show()}finally{isLoading=!1}} document.addEventListener('DOMContentLoaded',()=>{const radioButtons=document.querySelectorAll('input[name="texttype"]');radioButtons.forEach(button=>{button.addEventListener('change',updatePlaceholder)});displayPosts();displayMiniPosts();updatePlaceholder();const submitButton=document.getElementById("submitButton");if(submitButton){submitButton.addEventListener("click",submitPost);submitButton.innerHTML="æŠ•ç¨¿ <md-ripple></md-ripple>"} const loadMoreButton=document.getElementById("loadMoreButton");if(loadMoreButton){loadMoreButton.addEventListener("click",()=>displayPosts(!0));loadMoreButton.innerHTML="ã‚‚ã£ã¨èª­ã¿è¾¼ã‚€ <md-ripple></md-ripple>"} updatePreview()});const bgColorPicker=document.getElementById('bg');const textColorPicker=document.getElementById('color');const bgBox=document.getElementById('bgBox');const textBox=document.getElementById('textBox');const text=document.getElementById('text');bgColorPicker.addEventListener('input',updatePreview);textColorPicker.addEventListener('input',updatePreview);function updatePreview(){bgBox.style.backgroundColor=bgColorPicker.value;textBox.style.backgroundColor=textColorPicker.value;text.style.backgroundColor=bgColorPicker.value+"aa";text.style.color=textColorPicker.value} const elementA=document.querySelector('#text');const elementB=document.querySelector('.menu-container');if(elementA&&elementB){elementA.addEventListener('focus',()=>{elementB.style.right='calc(50vw + 310px)'});elementA.addEventListener('blur',()=>{elementB.style.right='calc(50vw + 260px)'})} const openDialogButton=document.getElementById('openDialogButton');const dialog=document.getElementById('myDialog');openDialogButton.addEventListener('click',async()=>{await dialog.show()});export{submitPost,displayPosts,displayMiniPosts}
